/*
    通用表单验证方法
    Validform version 3.0
    For more information, you can visit www.rjboy.cn
    By sean during April 7, 2010 - August 7, 2011
*/

(function(d){var e=null,c,b=true,a={w:"请输入正确信息！",r:"通过信息验证！",c:"正在检测信息…",s:"请填入信息！",v:"所填信息没有经过验证，请稍后…",p:"正在提交数据…",err:"提交数据出错，请检查地址是否正确！"},f=function(){if(d("#Validform_msg").length!==0){return false}c=d('<div id="Validform_msg"><div class="Validform_title">提示信息<a class="Validform_close" href="javascript:void(0);">&chi;</a></div><div class="Validform_info"></div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"></iframe></div></div>').appendTo("body");c.find("a.Validform_close").click(function(){c.hide();b=true;if(e){e.focus().addClass("Validform_error")}return false}).focus(function(){this.blur()});d(window).bind("scroll resize",function(){if(!b){var i=(d(window).width()-c.width())/2,h=(d(window).height()-c.height())/2,g=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(h>0?h:0);c.animate({left:i,top:g},{duration:400,queue:false})}})};d.fn.Validform=function(g){var h={};g=d.extend({},d.fn.Validform.sn.defaults,g);g.datatype&&d.extend(d.Datatype,g.datatype);this.each(function(){var k=d(this);var j=false;k.find("[tip]").each(function(){var m=d(this).attr("tip");var l=d(this).attr("altercss");d(this).focus(function(){if(d(this).val()==m){d(this).val("");if(l){d(this).removeClass(l)}}}).blur(function(){if(d.trim(d(this).val())===""){d(this).val(m);if(l){d(this).addClass(l)}}})});k.find("[datatype]").blur(function(){var l=true;l=d.fn.Validform.sn.checkform(d(this),k,{type:g.tiptype,sweep:g.tipSweep},"hide");if(!l){return false}if(typeof(l)!="boolean"){d(this).removeClass("Validform_error");return false}l=d.fn.Validform.sn.regcheck(d(this).attr("datatype"),d(this).val());if(!l){if(d(this).attr("ignore")==="ignore"&&(d(this).val()===""||d(this).val()===d(this).attr("tip"))){if(g.tiptype==2){d(this).parent().next().find(".Validform_checktip").removeClass().addClass("Validform_checktip").text("")}else{if(typeof g.tiptype=="function"){(g.tiptype)("",{obj:d(this),type:4},d.fn.Validform.sn.cssctl)}}l=true;e=null;return true}e=d(this);d.fn.Validform.sn.showmsg(d(this).attr("errormsg")||a.w,g.tiptype,{obj:d(this),sweep:g.tipSweep},"hide")}else{if(d(this).attr("ajaxurl")){var m=d(this);m.attr("valid",a.c);d.fn.Validform.sn.showmsg(a.c,g.tiptype,{obj:m,type:1,sweep:g.tipSweep},"hide");d.ajax({type:"POST",url:m.attr("ajaxurl"),data:"param="+d(this).val()+"&name="+d(this).attr("name"),dataType:"text",success:function(n){if(n=="y"){m.attr("valid","true");e=null;d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:m,type:2,sweep:g.tipSweep},"hide")}else{m.attr("valid",n);e=m;d.fn.Validform.sn.showmsg(n,g.tiptype,{obj:m,sweep:g.tipSweep})}},error:function(){m.attr("valid",a.err);e=m;d.fn.Validform.sn.showmsg(a.err,g.tiptype,{obj:m,sweep:g.tipSweep})}})}else{e=null;d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:d(this),type:2,sweep:g.tipSweep},"hide")}}});k.find(":checkbox[datatype],:radio[datatype]").each(function(){var m=d(this);var l=m.attr("name");k.find("[name="+l+"]").filter(":checkbox,:radio").not("[datatype]").bind("blur",function(){m.trigger("blur")})});var i=function(){var l=true;if(j){return false}k.find("[datatype]").each(function(){l=d.fn.Validform.sn.checkform(d(this),k,{type:g.tiptype,sweep:g.tipSweep});if(!l){e.focus();return false}if(typeof(l)!="boolean"){l=true;return true}l=d.fn.Validform.sn.regcheck(d(this).attr("datatype"),d(this).val());if(!l){if(d(this).attr("ignore")==="ignore"&&(d(this).val()===""||d(this).val()===d(this).attr("tip"))){l=true;e=null;return true}e=d(this);e.focus();d.fn.Validform.sn.showmsg(d(this).attr("errormsg")||a.w,g.tiptype,{obj:d(this),sweep:g.tipSweep});return false}if(d(this).attr("ajaxurl")){if(d(this).attr("valid")!="true"){l=false;var m=d(this);e=m;e.focus();d.fn.Validform.sn.showmsg(m.attr("valid")||a.v,g.tiptype,{obj:m,sweep:g.tipSweep});if(!b||g.tiptype!=1){setTimeout(function(){m.trigger("blur")},2000)}return false}else{d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:d(this),type:2,sweep:g.tipSweep},"hide");l=true}}});if(l&&!j){e=null;if(g.postonce){j=true}if(g.ajaxPost){d.fn.Validform.sn.showmsg(a.p,g.tiptype,{obj:k,type:1,sweep:g.tipSweep},"alwaysshow");d.ajax({type:"POST",dataType:"json",url:k.attr("action"),data:k.serialize(),success:function(m){if(m.status==="y"){d.fn.Validform.sn.showmsg(m.info,g.tiptype,{obj:k,type:2,sweep:g.tipSweep},"alwaysshow")}else{d.fn.Validform.sn.showmsg(m.info,g.tiptype,{obj:k,type:3,sweep:g.tipSweep},"alwaysshow")}g.callback&&(g.callback)(m)},error:function(){d.fn.Validform.sn.showmsg(a.err,g.tiptype,{obj:k,type:3,sweep:g.tipSweep},"alwaysshow")}});return false}else{g.callback?(g.callback)():k.get(0).submit()}}};g.btnSubmit&&k.find(g.btnSubmit).bind("click",i);k.submit(function(){i();return false})});if(g.tiptype==1||(g.tiptype==2&&g.ajaxPost)){f()}};d.fn.Validform.sn={defaults:{tiptype:1,tipSweep:false,postonce:false,ajaxPost:false},toString:Object.prototype.toString,regcheck:function(i,k){if(this.toString.call(d.Datatype[i])=="[object Function]"){return(d.Datatype[i])(k)}if(!(i in d.Datatype)){var m=i.match(d.Datatype.match),g;reg:for(var h in d.Datatype){g=h.match(d.Datatype.match);if(!g){continue reg}if(m[1]===g[1]){var l=d.Datatype[h].toString();var j=new RegExp("\\{"+g[2]+","+g[3]+"\\}");l=l.replace(j,"{"+m[2]+","+m[3]+"}").replace(/^\//,"").replace(/\/$/,"");d.Datatype[i]=new RegExp(l);break reg}}}if(this.toString.call(d.Datatype[i])=="[object RegExp]"){return d.Datatype[i].test(k)}return false},showmsg:function(l,h,k,g){if(e){e.addClass("Validform_error")}if(typeof h=="function"){if(!(k.sweep&&g=="hide")){(h)(l,k,this.cssctl)}return false}if(h==1||g=="alwaysshow"){c.find(".Validform_info").text(l)}if(h==1&&g!="hide"||g=="alwaysshow"){b=false;c.find(".iframe").css("height",c.height());var j=(d(window).width()-c.width())/2;var i=(d(window).height()-c.height())/2;i=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(i>0?i:0);c.css({left:j}).show().animate({top:i},100)}if(h==2&&k.obj){k.obj.parent().next().find(".Validform_checktip").text(l);this.cssctl(k.obj.parent().next().find(".Validform_checktip"),k.type)}},checkform:function(k,j,g,o){var l=k.attr("errormsg")||a.w,i;if(k.is("[datatype='radio']")){i=k.attr("name");var n=j.find(":radio[name="+i+"]:checked").val();if(!n){e=k;this.showmsg(l,g.type,{obj:k,sweep:g.sweep},o);return false}e=null;this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide");return"radio"}if(k.is("[datatype='checkbox']")){i=k.attr("name");var m=j.find(":checkbox[name="+i+"]:checked").val();if(!m){e=k;this.showmsg(l,g.type,{obj:k,sweep:g.sweep},o);return false}e=null;this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide");return"checkbox"}if(k.is("[datatype='select']")){if(!k.val()){e=k;this.showmsg(l,g.type,{obj:k,sweep:g.sweep},o);return false}e=null;this.showmsg(a.r,g.type,{obj:k,type:2,sweep:g.sweep},"hide");return"select"}var p=k.attr("tip");if((d.trim(k.val())===""||k.val()===p)&&k.attr("ignore")!="ignore"){e=k;this.showmsg(k.attr("nullmsg")||a.s,g.type,{obj:k,sweep:g.sweep},o);return false}if(k.attr("recheck")){var h=j.find("input[name="+k.attr("recheck")+"]:first");if(k.val()!=h.val()){e=k;this.showmsg(l,g.type,{obj:k,sweep:g.sweep},o);return false}}k.removeClass("Validform_error");e=null;return true},cssctl:function(h,g){switch(g){case 1:h.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");break;case 2:h.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");break;case 4:h.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");break;default:h.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong")}}};d.Showmsg=function(g){f();d.fn.Validform.sn.showmsg(g,1)};d.Hidemsg=function(){c.hide();b=true};d.Datatype={match:/^(.+)(\d+)-(\d+)$/,"*":/.+/,"*6-16":/^.{6,16}$/,n:/^\d+$/,s:/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/m,"s6-18":/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,p:/^[0-9]{6}$/,m:/^13[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$/,e:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/}})(jQuery);
